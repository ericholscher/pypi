<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="standard_template/macros/page">

<metal:fill fill-slot="head">
 <meta tal:condition="data/release/keywords | nothing"
       name="keywords"
       tal:attributes="content data/release/keywords" />
 <meta tal:condition="data/release/summary | nothing"
       name="description"
       tal:attributes="content data/release/summary" />
 <link rel="meta" title="DOAP" type="application/rdf+xml"
       tal:attributes="href string:${app/url_path}?:action=doap&amp;name=${data/name}&amp;version=${data/version}" />
 <style type="text/css">
  table.form th {white-space: pre;}
 </style>
</metal:fill>

<metal:fill fill-slot="body">
<p style="font-style: italic" tal:content="data/release/summary | nothing" />

<p tal:condition="not:data/usinglatest">
<strong>Latest Version: </strong><a tal:attributes="href data/latestversionurl" title="Latest Version URL">
<span tal:content="data/latestversion" />
</a>
</p>


<p tal:replace="structure app/release_nav" />

<tal:element replace="structure data/release/description_html" />

<table tal:define="files python:app.store.list_files(data['name'], data['version'])"
       tal:condition="files" class="list" style="margin-bottom: 10px;">
<tr>
  <th>File</th>
  <th>Type</th>
  <th>Py Version</th>
  <th>Uploaded on</th>
  <th style="text-align: right;">Size</th>
  <th style="text-align: right;"># downloads</th>
</tr>

<tr tal:repeat="file python:app.store.list_files(data['name'], data['version'])"
    tal:attributes="class repeat/file/parity">
<tal:block tal:define="
      name       file/filename;
      url        python:app.store.gen_file_url(file['python_version'], data['name'], file['filename']);
      comments   file/comment_text;
      pkg_type   python:app.dist_file_types_d[file['packagetype']];
      py_version file/python_version;
      uploaded   python:file['upload_time'].strftime('%Y-%m-%d');
      size       python:app.pretty_size(file['size']);
      downloads  file/downloads;
      md5_url    string:${app/url_path}?:action=show_md5&amp;digest=${file/md5_digest};
      pgp_url    python:file['has_sig'] and app.store.gen_file_url(
                   file['python_version'], data['name'], file['filename'])+'.asc';
      ">
    <td>
    <span style="white-space: nowrap;">
      <a tal:attributes="href string:$url#md5=${file/md5_digest}"
         tal:content="name" />
      (<a tal:attributes="href md5_url" title="MD5 Digest">md5</a><tal:block tal:condition="pgp_url">,
       <a tal:attributes="href pgp_url" title="PGP Signature">pgp</a></tal:block>)
    </span>
    <tal:block tal:condition="comments">
      <br />
      <span tal:replace="comments" />
    </tal:block>
        </td>
  <td style="white-space: nowrap;">
    <span tal:replace="pkg_type" />
  </td>
  <td>
    <span tal:replace="py_version" tal:condition="python:py_version != 'source'" />
  </td>
  <td tal:content="uploaded" />
  <td tal:content="size" style="text-align: right;" />
  <td tal:content="downloads" style="text-align: right;" />
</tal:block>
</tr>

<tr><td id="last" colspan="5"></td></tr>
  </table>

<ul class="nodot">
 <li tal:condition="data/release/author | nothing">
  <strong>Author:</strong>
  <span tal:content="data/release/author" />
 </li>

 <li tal:condition="data/release/maintainer | nothing">
  <strong>Maintainer:</strong>
  <span tal:content="data/release/maintainer" />
 </li>

 <li tal:condition="data/docs | nothing">
  <strong>Documentation:</strong>
  <a tal:attributes="href data/docs" tal:content="string:${data/name} documentation" />
 </li>

<!-- The <th> elements below are a terrible terrible hack for setuptools -->
 <li tal:condition="data/release/home_page | nothing">
  <strong>Home Page:</strong>
  <!-- <th>Home Page -->
  <a tal:attributes="href data/release/home_page"
         tal:content="data/release/home_page" />
 </li>

 <li tal:condition="data/release/download_url | nothing">
  <strong>Download URL:</strong>
  <!-- <th>Download URL -->
  <a tal:attributes="href data/release/download_url"
         tal:content="data/release/download_url" />
 </li>


 <li tal:condition="data/release/keywords | nothing">
  <strong>Keywords:</strong>
  <span tal:content="data/release/keywords" />
 </li>

 <li tal:condition="data/release/license | nothing">
  <strong>License:</strong>
  <tal:block define="hasnl python:'\n' in data['release']['license']">
  <pre tal:condition="hasnl" tal:content="structure data/release/license" />
  <span tal:condition="not:hasnl" tal:content="data/release/license" />
  </tal:block>
 </li>

 <li tal:condition="data/release/platform | nothing">
  <strong>Platform:</strong>
  <span tal:content="structure
  python:data['release']['platform'].replace('\n', ', ')" />
 </li>

<!-- TODO: add link to products in follow dependencies... -->
 <li tal:condition="data/requires | nothing">
  <strong>Requires</strong>
  <tal:element replace="structure python:', '.join(data['requires'])" />
 </li>
 <li tal:condition="data/provides | nothing">
  <strong>Provides</strong>
  <tal:element replace="structure python:', '.join(data['provides'])" />
 </li>
 <li tal:condition="data/obsoletes | nothing">
  <strong>Obsoletes</strong>
  <tal:element replace="structure python:', '.join(data['obsoletes'])" />
 </li>

 <li tal:condition="data/categories | nothing">
  <strong>Categories</strong>
  <ul class="nodot">
   <li tal:repeat="category data/categories">
    <a tal:attributes="href category/url"
       tal:content="structure category/pathstr"/>
   </li>
  </ul>
 </li>



 <li tal:condition="data/requires_dist | nothing">
   <strong>Requires Distributions</strong>
   <ul class="nodot">
     <li tal:repeat="require data/requires_dist">
       <a tal:condition="require/href" tal:attributes="href require/href"
           tal:content="require/name"/>
        <tal:block tal:condition="not:require/href" 
                   tal:replace="require/name">
        </tal:block>
     </li>
   </ul>
 </li>

 <li tal:condition="data/provides_dist | nothing">
   <strong>Provides Distributions</strong>
   <ul class="nodot">
     <li tal:repeat="provide data/provides_dist">
       <a tal:condition="provide/href" tal:attributes="href provide/href"
           tal:content="provide/name"/>
       <tal:block tal:condition="not:provide/href" 
                   tal:replace="provide/name">
        </tal:block>

     </li>
   </ul>
 </li>

 <li tal:condition="data/obsoletes_dist | nothing">
   <strong>Obsoletes Distributions</strong>
   <ul class="nodot">
     <li tal:repeat="obsolete data/obsoletes_dist">
       <a tal:condition="obsolete/href" tal:attributes="href obsolete/href"
           tal:content="obsolete/name"/>
        <tal:block tal:condition="not:obsolete/href" 
                   tal:replace="obsolete/name">
        </tal:block>

     </li>
   </ul>
 </li>

 <li tal:condition="data/requires_external | nothing">
   <strong>Requires Externals</strong>
   <ul class="nodot">
     <li tal:repeat="require data/requires_external">
        <tal:block tal:replace="require">
        </tal:block>
     </li>
   </ul>
 </li>

 <li tal:condition="data/requires_python | nothing">
    <strong>Requires Python</strong>: <tal:block tal:replace="data/requires_python"></tal:block>
 </li>


 <li tal:condition="data/roles/Owner | nothing">
  <strong>Package Index Owner:</strong>
  <span tal:content="python:', '.join(data['roles']['Owner'])" />
 </li>

 <li tal:condition="data/roles/Maintainer | nothing">
  <strong>Package Index Maintainer:</strong>
  <span tal:content="python:', '.join(data['roles']['Maintainer'])" />
 </li>

 <li>
  <strong><a href="http://usefulinc.com/doap">DOAP</a> record:</strong>
  <a tal:content="string:${data/name}-${data/version}.xml"
  tal:attributes="href string:${app/url_path}?:action=doap&amp;name=${data/name}&amp;version=${data/version}" />
 </li>

</ul>

<div tal:condition="python:app.loggedin and not (app.store.has_role('Maintainer', data['name']) or app.store.has_role('Owner', data['name']))">
  <div tal:condition="data/has_rated">
    <form tal:attributes="action string:${app/url_path}/${data/name}/${data/version}" method="POST">
      <input type="hidden" name=":action" value="rate"/>
      <input type="hidden" name="name" tal:attributes="value data/name"/>
      <input type="hidden" name="version" tal:attributes="value data/version"/>
      <input type="submit" name="remove" value="Remove your rating" />
    </form>
  </div>
  <div tal:condition="not:data/has_rated">
    <form tal:attributes="action string:${app/url_path}/${data/name}/${data/version}" method="POST">
      <input type="hidden" name=":action" value="rate"/>
      <input type="hidden" name="name" tal:attributes="value data/name"/>
      <input type="hidden" name="version" tal:attributes="value data/version"/>
      <table>
      <tr>
      <td>Rate this release: 0</td>
      <td><input type="radio" name="rating" value="0"/></td>
      <td><input type="radio" name="rating" value="1"/></td>
      <td><input type="radio" name="rating" value="2"/></td>
      <td><input type="radio" name="rating" value="3"/></td>
      <td><input type="radio" name="rating" value="4"/></td>
      <td><input type="radio" name="rating" value="5"/></td>
      <td>5 (best)</td>
      </tr>
      </table>
      <table tal:condition="python:app.store.get_package_comments(data['name'])"><tr><td>Review: (<em>Please use the package's bug reporting channels <br/>(trackers, mailing lists) for bug reports and requests for help</em>)</td><td>
         <!--XXX trick TAL into not minimizing tag-->
         <textarea name="comment" rows="5" cols="40" wrap="soft"> </textarea>
      </td></tr></table>
      <input type="submit" name="rate" value="Rate"/>
    </form>
    <form tal:condition="data/latest_rating" tal:attributes="action string:${app/url_path}/${data/name}/${data/version}" method="POST">
      <input type="hidden" name=":action" value="rate"/>
      <input type="hidden" name="name" tal:attributes="value data/name"/>
      <input type="hidden" name="version" tal:attributes="value data/version"/>
      <input type="hidden" name="fromversion" tal:attributes="value data/latest_rating"/>
      <input type="submit" name="copy" tal:attributes="value string:Copy your rating from release ${data/latest_rating}"/>
    </form>
  </div>
</div>
<div tal:condition="not:app/loggedin">
 <p><em>Log in to rate this package.</em></p>
</div>

<div tal:condition="data/nr_ratings">
       Package rating (<span tal:replace="data/nr_ratings"/> vote<tal:block tal:condition="python:data['nr_ratings'] != 1">s</tal:block>): 
       <span tal:replace="python:float(data['sum_ratings'])/data['nr_ratings']"/>

  <ul>
   <tal:block  tal:repeat="i python:range(6)">
   <li tal:condition="python:data['tally_ratings'][i]">
    <span tal:replace="i"/> point<tal:block tal:condition="python:i != 1">s</tal:block>:
    <span tal:replace="python:data['tally_ratings'][i]"/> vote<tal:block tal:condition="python:data['tally_ratings'][i] != 1">s</tal:block>
   </li>
   </tal:block>
  </ul>
  <p>Ratings range from 0 to 5 (best).</p>
</div>

<div tal:condition="python:not app.store.get_package_comments(data['name'])">The package owner has disabled commenting on this package.</div>

<div tal:condition="python:app.store.get_package_comments(data['name']) and data['comments']">
<b>Package Comments:</b>
<span tal:replace="structure data/comments"/>
</div>

<table tal:condition="python:app.loggedin and (app.store.has_role('Admin') or
  app.store.has_role('Maintainer', data['name']) or app.store.has_role('Owner', data['name']))" class="history">
 <tr><th colspan="4" class="header">Journal</th></tr>
 <tr><th>Action</th><th>Date</th><th>User</th><th>Address</th></tr>
 <tr tal:repeat="
         entry python:app.store.get_journal(data['name'], data['version'])"
     tal:attributes="class repeat/entry/parity">
  <td nowrap="" tal:content="entry/action" />
  <td nowrap="" tal:content="python:str(entry['submitted_date'])[:-3]" />
  <td nowrap="" tal:content="entry/submitted_by" />
  <td nowrap="" tal:content="entry/submitted_from" />
 </tr>
</table>

</metal:fill>
</html>
