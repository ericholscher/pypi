<?xml version="1.0" encoding="UTF-8"?>
<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="standard_template/macros/page">

<metal:fill fill-slot="head">
 <meta tal:condition="data/release/keywords | nothing"
       name="keywords"
       tal:attributes="content data/release/keywords" />
 <meta tal:condition="data/release/summary | nothing"
       name="description"
       tal:attributes="content data/release/summary" />
 <style type="text/css">
  table.form th {white-space: pre;}
 </style>
</metal:fill>

<metal:fill fill-slot="body">

<p tal:content="data/release/summary | nothing" />

<p tal:replace="structure app/release_nav" />

<table tal:define="files python:app.store.list_files(data['name'],
          data['version'])" 
       tal:condition="files" class="history">
 <tr><th colspan="6" class="header">Release Files</th></tr>
 <tr>
  <th>Type</th><th>Py Version</th><th>Comment</th>
  <th>Download</th><th>Size</th><th># downloads</th>
 </tr>

 <tr tal:repeat="file python:app.store.list_files(data['name'], data['version'])"
     tal:attributes="class python:repeat['file'].end() and 'last'">
  <td tal:content="python:app.dist_file_types_d[file['packagetype']]" />
  <td tal:content="file/python_version" />
  <td tal:content="file/comment_text" />
  <td>
   <a tal:attributes="href python:app.store.gen_file_url(file['python_version'],
        data['name'], file['filename'])"
    tal:content="file/filename" />
    (<a tal:attributes="href string:${app/url_path}?:action=show_md5&amp;digest=${file/md5_digest}">md5</a><tal:block tal:condition="file/has_sig">,
    <a title="PGP signature"
       tal:attributes="href python:app.store.gen_file_url(file['python_version'],
        data['name'], file['filename'])+'.asc'"
       tal:content="string:sig" /></tal:block>)
  </td>
  <td tal:content="python:app.pretty_size(file['size'])" />
  <td tal:content="file/downloads"/>
 </tr>
</table>

<table class="form">
 <tr tal:condition="data/release/author | nothing">
  <th>Author:</th>
  <td tal:content="data/release/author" />
 </tr>

 <tr tal:condition="data/release/maintainer | nothing">
  <th>Maintainer:</th>
  <td tal:content="data/release/maintainer" />
 </tr>

 <tr tal:condition="data/release/home_page | nothing">
  <th>Home Page:</th>
  <td><a tal:attributes="href data/release/home_page"
         tal:content="data/release/home_page" />
  </td>
 </tr>

 <tr tal:condition="data/release/download_url | nothing">
  <th>Download URL:</th>
  <td><a tal:attributes="href data/release/download_url"
         tal:content="data/release/download_url" />
  </td>
 </tr>

 <tr tal:condition="data/release/description_html | nothing">
  <th>Description:</th>
  <td tal:content="structure data/release/description_html" />
 </tr>

 <tr tal:condition="data/release/keywords | nothing">
  <th>Keywords:</th>
  <td tal:content="data/release/keywords" />
 </tr>

 <tr tal:condition="data/release/license | nothing">
  <th>License:</th>
  <td><pre tal:content="structure data/release/license" />
  </td>
 </tr>

 <tr tal:condition="data/release/platform | nothing">
  <th>Platform:</th>
  <td><pre tal:content="structure data/release/platform" />
  </td>
 </tr>

 <tal:block tal:content="structure data/dependencies"/>

 <tr tal:condition="data/roles/Owner | nothing">
  <th>Cheese Shop Owner:</th>
  <td tal:content="python:', '.join(data['roles']['Owner'])" />
 </tr>

 <tr tal:condition="data/roles/Maintainer | nothing">
  <th>Cheese Shop Maintainer:</th>
  <td tal:content="python:', '.join(data['roles']['Maintainer'])" />
 </tr>

</table>

<table tal:condition="python:app.store.has_role('Admin') or
  app.store.has_role('Maintainer') or app.store.has_role('Owner')" class="history">
 <tr><th colspan="4" class="header">Journal</th></tr>
 <tr><th>Action</th><th>Date</th><th>User</th><th>Address</th></tr>
 <tr tal:repeat="
         entry python:app.store.get_journal(data['name'], data['version'])"
     tal:attributes="class repeat/entry/parity">
  <td nowrap="" tal:content="entry/action" />
  <td nowrap="" tal:content="python:str(entry['submitted_date'])[:-3]" />
  <td nowrap="" tal:content="entry/submitted_by" />
  <td nowrap="" tal:content="entry/submitted_from" />
 </tr>
</table>

</metal:fill>
</html>
